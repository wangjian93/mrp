<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>MRP数据</title>
    <link rel="stylesheet" href="../../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../../assets/module/admin.css?v=318"/>
    <!--[if lt IE 9]>
    <script src="../../../assets/libs/html5shiv/html5shiv.min.js"></script>
    <script src="../../../assets/libs/respond/respond.min.js"></script>
    <![endif]-->

    <!-- 表格单元格高宽 -->
    <style>
        .layui-table-view .layui-table td .layui-table-cell, .layui-table-view .layui-table[lay-size="sm"] td .layui-table-cell {
            height: auto;
            padding: 0px 0px;
        }
        .layui-table-view .layui-table th .layui-table-cell, .layui-table-view .layui-table[lay-size="sm"] th .layui-table-cell {
            height: auto;
            padding: 0px 0px;
        }

        .layui-table-view .layui-table td, .layui-table-view .layui-table th {
            padding: 0px 0px;
        }
    </style>
</head>
<body>

<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-row">

        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header"><i class="layui-icon layui-icon-tabs"></i> LCM MRP数据</div>
                <div class="layui-card-body">
                    <!-- MRP FLOW -->
                    <ul id="flow">
                        <li style="border-bottom: 1px #fff3e0 solid;">
                            <div style="white-space: nowrap;">
                                <div style="width: 100px;height:30px;display: inline-block;">
                                    料号
                                </div>
                                <div style="width: 100px;height:30px;display: inline-block;">
                                    物料组
                                </div>
                                <div style="width: 100px;height:30px;display: inline-block;">
                                    物料名
                                </div>
                                <div style="width: 100px;height:30px;display: inline-block;">
                                    物料组名
                                </div>
                                <div style="width: 100px;height:30px;display: inline-block;">
                                    厂别
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header"><i class="layui-icon layui-icon-tabs"></i> LCM MRP数据</div>
                <div class="layui-card-body">
                    <!-- MRP表格 -->
                    <table id="table_mrp" lay-filter="table_mrp"></table>
                </div>
            </div>
        </div>


    </div>

</div>

<!-- 行数据模板 -->
<script type="text/html" id="rowDemo">
    <li style="border-bottom: 1px #fff3e0 solid;">
        <div style="white-space: nowrap;">
            <div style="width: 100px;height:auto;display: inline-block;">
                {{ d.material }}
            </div>
            <div style="width: 100px;height:auto;display: inline-block;">
                {{ d.materialName }}
            </div>
            <div style="width: 100px;height:auto;display: inline-block;">
                {{ d.materialGroup }}
            </div>
            <div style="width: 100px;height:auto;display: inline-block;">
                {{ d.materialGroupName }}
            </div>
            <div style="width: 100px;height:auto;display: inline-block;">
                {{ d.fab }}
            </div>
            {{# var id = "MRP2_"+d.material }}
            <div id="{{ id }}" style="width: 6400px;height:140px;display: inline-block;"></div>
        </div>
    </li>
</script>

<!-- MRP行数据模板 -->
<script type="text/html" id="mrpDemo">
    <div style="width: 100px;display: inline-block;">
        <div>{{ d.demandQty }}</div>
        <div>{{ d.lossQty }}</div>
        <div>{{ d.arrivalQty }}</div>
        <div>{{ d.balanceQty }}</div>
        <div>{{ d.shortQty }}</div>
        <div>{{ d.allocationQty }}</div>
        <div>{{ d.fabDate }}</div>
    </div>
</script>

<!-- js部分 -->
<script type="text/javascript" src="../../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../../assets/js/common.js?v=318"></script>
<script>
    layui.use(['flow', 'table', 'laytpl'], function() {
        var $ = layui.$;
        var flow = layui.flow;
        var table = layui.table;
        var laytpl = layui.laytpl;

        var ver = '20200909001';

        //MRP数据表格
        table.render({
            elem: '#table_mrp',
            url: '/mrp/mrp/getPageMrpLcmMaterial',
            where: {
                ver: ver
            },
            cols: [[
                {type: 'numbers', align: 'center'},
                {field: 'material', title: '料号', align: 'center', width: 140},
                // {field: 'materialName', title: '物料名', align: 'center', width: 140},
                // {field: 'materialGroup', title: '物料组', align: 'center', width: 140},
                // {field: 'materialGroupName', title: '物料组名', align: 'center', width: 140},
                // {field: 'fab', title: '厂别', align: 'center', width: 140},
                // {field: 'lossRate', title: '损耗率', align: 'center', width: 140},
                {field: 'goodInventory', title: '良品库存', align: 'center', width: 140},
                {field: 'dullInventory', title: '呆滞库存', align: 'center', width: 140},
                // {field: 'inventorDate', title: '库存日期', align: 'center', width: 140},
                // {field: 'products', title: '机种', align: 'center', width: 140},
                // {field: 'suppliers', title: '供应商', align: 'center', width: 140},
                // {field: 'supplierCodes', title: '供应商', align: 'center', width: 140},
                // {field: 'customers', title: '客户', align: 'center', width: 140},
                // {field: 'createDate', title: '创建时间', align: 'center', width: 140},
                {title: '', align: 'center', width: 64*100,
                    templet: function(data) {
                        var material = data.material;
                        var id = 'mrp_'+material;
                        return '<div id="'+id+'" style="white-space: nowrap;"></div>';
                    }
                }
            ]],
            done: function(res, curr, count) {
                layui.each(res.data, function(index, item){
                    var material = item.material;
                    var id = 'mrp_'+material;
                    $.get('/mrp/mrp/getMrpLcm',{
                        ver: ver,
                        material: material
                    }, function(res2){
                        var lis = [];
                        layui.each(res2.data, function(index2, item2){
                            lis.push(laytpl(mrpDemo.innerHTML).render(item2));
                        });
                        $('#'+id).html(lis.join(''));
                    });
                });
            },
            page: true,
            limit: 50,
            size: 'sm'
        });

        //信息流
        flow.load({
            elem: '#flow', //指定列表容器
            // scrollElem: '#flow',
            // mb: 8000,
            done: function(page, next){ //到达临界点（默认滚动触发），触发下一页
                var lis = [];
                var limit = 5;

                $.get('/mrp/mrp/getPageMrpLcmMaterial?ver='+ver+'&limit='+limit+'&page='+page, function(res){
                    //假设你的列表返回在data集合中
                    layui.each(res.data, function(index, item){
                        lis.push(laytpl(rowDemo.innerHTML).render(item));
                    });

                    //执行下一页渲染，第二参数为：满足“加载更多”的条件，即后面仍有分页
                    //pages为Ajax返回的总页数，只有当前页小于总页数的情况下，才会继续出现加载更多
                    var count = res.count;
                    var pages = count / limit;
                    if(count % limit > 0) {
                        pages+=1;
                    }
                    next(lis.join(''), page < pages);

                    layui.each(res.data, function(index, item){
                        var material = item.material;
                        var id = 'MRP2_'+material;
                        $.get('/mrp/mrp/getMrpLcm',{
                            ver: ver,
                            material: material
                        }, function(res2){
                            var lis2 = [];
                            layui.each(res2.data, function(index2, item2){
                                lis2.push(laytpl(mrpDemo.innerHTML).render(item2));
                            });
                            $('#'+id).html(lis2.join(''));
                        });
                    });
                });
            }
        });
    });
</script>
</body>
</html>